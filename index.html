<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <link rel="stylesheet" type="text/css" href="css/semantic.css">
    <title>First ThreeJS Test</title>

    <style type="text/css">

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: arial;
        font-size: 12px;
      }

      html, body {
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      canvas {
        width: 100%;
        height: 100%;
      }

      input {
        width: 50px;
        margin-right: 10px;
      }

      .controls {
        padding: 10px;
      }

    </style>

    <script type="text/javascript" src="js/three.min.js"></script>
  </head>
  <body>
    <div class='controls'>

        <div class="ui equal width grid">
          <div class='equal width row'>
            <div class='column'>
              <div class='ui segment'>
                <h5 class='ui header'>Table Length</h5>
                <div id='table-length-out' class='ui blue pointing right label'>15</div>
                <input id='table-length' type='range' min='36' max='72' step='1'/>
              </div>
            </div>
            <div class='column'>
              <div class='ui segment'>
                <h5 class='ui header'>Table Width</h5>
                <div id='table-width-out' class='ui blue pointing right label'>15</div>
                <input id='table-width' type='range' min='12' max='36' step='1' />
              </div>            
            </div>
            <div class='column'>
              <div class='ui segment'>
                <h5 class='ui header'>Table Thickness</h5>
                <div id='table-thick-out' class='ui blue pointing right label'>15</div>
                <input id='table-thick' type='range' min='1' max='2' step='.5' />
              </div>
            </div>  
            <div class='column'>
              <div class='ui segment'>
                <h5 class='ui header'>Table Height</h5>
                <div id='table-height-out' class='ui blue pointing right label'>15</div>
                <input id='table-height' type='range' min='12' max='42' step='1'/>
              </div>
            </div>              
          </div>          
        </div>

<!--       <label for='table-length'>Length</label>
      <input type='text' id='table-length'>
      <label for='table-width'>Width</label>
      <input type='text' id='table-width'>
      <label for='table-height'>Height</label>
      <input type='text' id='table-height'>
      <label for='table-thickness'>Thickness</label>
      <input type='text' id='table-thickness'>
      <button id='update'>Update</button> -->
    </div>
    
    <script type="text/javascript">
    
      window.addEventListener('load', initForm, false);

      function initForm() {
        var sliders = document.querySelectorAll('input[type=range]');
        for (var i = 0; i < sliders.length; i++) {
          var slider = sliders[i];
          var outTarget = '#' + slider.id + '-out';
          
          slider.addEventListener('input', updateSlider, false);

          document.querySelector(outTarget).innerHTML = slider.value;

        }
      }

      function updateSlider(event) {
        var slider = event.target;
        var outTarget = '#' + slider.id + '-out';
        document.querySelector(outTarget).innerHTML = slider.value;
        update();
      }

      function update() {
        
        lengthScale = lengthInput.value / tableLength;
        widthScale = widthInput.value / tableWidth;
        heightScale = heightInput.value / tableHeight;
        thicknessScale = thicknessInput.value / topThickness;

        tableTop.scale.x = lengthScale;
        tableTop.scale.y = widthScale;
        tableTop.scale.z = thicknessScale;

        for (var i = 0; i < legs.length; i++) {
          legs[i].scale.z = heightScale;
        }

        legs[0].position.x = legWidth/2 + legOffset;
        legs[0].position.y = legWidth/2 + legOffset;
        legs[0].position.z = heightScale * tableHeight/2;

        legs[1].position.x = lengthScale * tableLength - legWidth/2 - legOffset;
        legs[1].position.y = legWidth/2 + legOffset;
        legs[1].position.z = heightScale * tableHeight/2;

        legs[2].position.x = legWidth/2 + legOffset;
        legs[2].position.y = widthScale * tableWidth - legWidth/2 - legOffset;
        legs[2].position.z = heightScale * tableHeight/2;

        legs[3].position.x = lengthScale * tableLength - legWidth/2 - legOffset;
        legs[3].position.y = widthScale * tableWidth - legWidth/2 - legOffset;
        legs[3].position.z = heightScale * tableHeight/2; 

        tableTop.position.x = lengthScale * tableLength / 2;
        tableTop.position.y = widthScale * tableWidth / 2;
        tableTop.position.z = heightScale * tableHeight;

      }

      function debugaxis(axisLength) {
          //Shorten the vertex function
          function v(x,y,z){
                  return new THREE.Vector3(x,y,z);
          }
         
          //Create axis (point1, point2, colour)
          function createAxis(p1, p2, color){
                  var line, lineGeometry = new THREE.Geometry(),
                  lineMat = new THREE.LineBasicMaterial({color: color, lineWidth: 1});
                  lineGeometry.vertices.push(p1, p2);
                  line = new THREE.Line(lineGeometry, lineMat);
                  scene.add(line);
          }
         
          createAxis(v(-axisLength, 0, 0), v(axisLength, 0, 0), 0xFF0000);
          createAxis(v(0, -axisLength, 0), v(0, axisLength, 0), 0x00FF00);
          createAxis(v(0, 0, -axisLength), v(0, 0, axisLength), 0x0000FF);
      };

      var tableWidth    = 30,
        tableHeight   = 26,
        tableLength   = 61,
        legWidth    = 2,
        topThickness  = 1.5,
        legOffset     = 1;

      var lengthScale = 1,
        widthScale = 1,
        heightScale = 1,
        thicknessScale = 1;

      var lengthInput = document.getElementById('table-length'),
        widthInput = document.getElementById('table-width'),
        heightInput = document.getElementById('table-height'),
        thicknessInput = document.getElementById('table-thick');
        // updateButton = document.getElementById('update');

      // // updateButton.onclick = update;

      lengthInput.value = tableLength;
      widthInput.value = tableWidth;
      heightInput.value = tableHeight;
      thicknessInput.value = topThickness;

      var scene = new THREE.Scene();
      var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);

      var ambientLight = new THREE.AmbientLight( 0x666666 );

      var renderer = new THREE.WebGLRenderer( {antialias: true} );
      renderer.setSize( window.innerWidth, window.innerHeight );
      document.body.appendChild( renderer.domElement );

      var topGeo = new THREE.BoxGeometry(tableLength, tableWidth, topThickness);
      var topMatl = new THREE.MeshLambertMaterial({
            map: THREE.ImageUtils.loadTexture('img/walnut01.jpg')
        });
      var tableTop = new THREE.Mesh(topGeo, topMatl);

      tableTop.position.x = tableLength/2;
      tableTop.position.y = tableWidth/2;
      tableTop.position.z = tableHeight + topThickness/2;

      var legGeo = new THREE.BoxGeometry(legWidth, legWidth, tableHeight);
      var legMatl = new THREE.MeshLambertMaterial({
        map: THREE.ImageUtils.loadTexture('img/millscale01.jpg')
      });

      var legs = [];

      for (var i = 0; i < 4; i++) {
        legs.push(new THREE.Mesh(legGeo, legMatl));
      }

      for (var i = 0; i < legs.length; i++) {
        scene.add(legs[i]);
      }

      scene.add(tableTop);
      scene.add(ambientLight);

      var light;
      light = new THREE.DirectionalLight( 0xdfebff, 1.75 );
      light.position.set( 50, 200, 100 );
      light.position.multiplyScalar( 1.3 );

      light.castShadow = true;
      //light.shadowCameraVisible = true;

      light.shadowMapWidth = 1024;
      light.shadowMapHeight = 1024;

      var d = 300;

      light.shadowCameraLeft = -d;
      light.shadowCameraRight = d;
      light.shadowCameraTop = d;
      light.shadowCameraBottom = -d;

      light.shadowCameraFar = 1000;
      light.shadowDarkness = 0.5;

      scene.add( light );

      camera.position.x = -10;
      camera.position.y = -50;
      camera.position.z = 50;
      camera.lookAt( new THREE.Vector3(tableLength/2, tableWidth/2, tableHeight) );
      camera.rotation.z += -1.15;

      update();

      debugaxis(35);

      function render() {
        requestAnimationFrame( render );
        renderer.render(scene, camera);
      }

      render();

    </script>
  </body>
</html>
